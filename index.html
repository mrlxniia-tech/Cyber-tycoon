<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Tycoon - Final V2.1</title>

    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    
    <style>
        :root { --neon: #00f2ff; --bg: #050508; --red: #ff4757; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { background: var(--bg); color: white; font-family: 'Courier New', monospace; height: 100vh; overflow: hidden; }
        
        /* MATRIX BG */
        #matrix { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.15; }

        /* WELCOME SCREEN */
        #welcome-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        #welcome-content { border: 2px solid var(--neon); padding: 30px; border-radius: 15px; box-shadow: 0 0 20px var(--neon); max-width: 400px; }
        .rules { font-size: 0.75rem; color: #aaa; margin: 15px 0; text-align: left; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px; }

        /* HEADER */
        #h { height: 100px; background: rgba(17,17,34,0.9); border-bottom: 2px solid var(--neon); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #m { font-size: 1.8rem; font-weight: bold; color: var(--neon); text-shadow: 0 0 10px var(--neon); }
        
        /* CLICK ZONE */
        #cz { height: 35vh; display: flex; align-items: center; justify-content: center; }
        #btn { width: 140px; height: 140px; border-radius: 50%; background: #111; border: 4px solid var(--neon); color: var(--neon); font-size: 4rem; box-shadow: 0 0 20px var(--neon); transition: 0.05s; }
        #btn:active { transform: scale(0.9); }

        /* UI BOTTOM */
        #ui { height: calc(65vh - 100px); background: rgba(8,8,16,0.95); border-top: 1px solid #333; display: flex; flex-direction: column; }
        #nav { display: flex; height: 50px; background: #000; border-bottom: 1px solid #222; }
        .t-btn { flex: 1; border: none; background: none; color: #555; font-weight: bold; font-size: 0.7rem; }
        .t-btn.active { color: var(--neon); border-bottom: 3px solid var(--neon); }
        
        .p { flex: 1; overflow-y: auto; padding: 15px; display: none; padding-bottom: 50px; }
        .p.active { display: block; }
        .card { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #222; }
        .b-btn { width: 100%; background: var(--neon); color: #000; border: none; padding: 10px; border-radius: 5px; font-weight: bold; margin-top: 5px; }
        .b-btn:disabled { background: #333; color: #666; }

        /* HACK EVENT */
        #hack-alert { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,0,0,0.95); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .hack-btn { background: white; color: red; padding: 20px 40px; border-radius: 10px; font-weight: bold; font-size: 1.5rem; border: none; margin-top: 20px; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .rank-line { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 0.8rem; }
        .me { color: var(--neon); background: rgba(0, 242, 255, 0.1); }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <div id="welcome-content">
            <h1 style="color: var(--neon);">CYBER TYCOON</h1>
            <p style="font-size: 0.8rem; margin: 10px 0;">V2.1 - SYSTEM ONLINE</p>
            <div class="rules">
                • Cliquez pour miner des €<br>
                • Achetez du hardware pour automatiser<br>
                • ⚠️ Défendez-vous contre les hacks<br>
                • (30min le WE / 1h la semaine)
            </div>
            <input type="text" id="pseudo-input" placeholder="NOM DE CODE..." style="width:100%; padding:10px; margin-bottom:15px; background:#111; border:1px solid var(--neon); color:white; text-align:center;">
            <button class="b-btn" onclick="initGame()">LANCER LA SESSION</button>
        </div>
    </div>

    <div id="hack-alert">
        <h1 style="font-size: 2.5rem;">⚠️ INTRUSION ⚠️</h1>
        <p>Un groupe rival tente de vider votre compte !</p>
        <button id="defend-btn" class="hack-btn" onclick="defendSystem()">SÉCURISER</button>
        <p id="hack-timer" style="margin-top: 20px;">Temps restant : 5s</p>
    </div>

    <canvas id="matrix"></canvas>

    <div id="h">
        <div id="m">0 €</div>
        <div id="income-bar" style="font-size: 0.7rem; color: #2ecc71;">+0 €/s</div>
        <div style="font-size: 0.6rem; color: #888; margin-top: 5px;">HACKER: <span id="display-name">...</span> | <span id="hack-mode">Mode Auto</span></div>
    </div>

    <div id="cz"><button id="btn" onclick="tap(event)">$</button></div>

    <div id="ui">
        <div id="nav">
            <button class="t-btn active" onclick="tab(event, 's')">HARDWARE</button>
            <button class="t-btn" onclick="tab(event, 't')">RÉSEAU</button>
            <button class="t-btn" onclick="tab(event, 'c')">SYSTEM</button>
        </div>

        <div id="s" class="p active"></div>
        
        <div id="t" class="p">
            <h3 style="color:var(--neon); margin-bottom:10px;">TOP PLAYERS</h3>
            <div id="leaderboard" class="card" style="padding:0;"></div>
        </div>

        <div id="c" class="p">
            <h3>OPTIONS</h3>
            <div class="card">
                <p>User: <b id="current-name"></b></p>
                <p>Ver: 2.1.0 (Auto-Update)</p>
                <button class="b-btn" style="background:#444; color:white; margin-top:20px;" onclick="resetAll()">RESET DATA</button>
            </div>
        </div>
    </div>

    <script>
        const v = "2.1.0";
        let g = { m: 0, n: "", rb: 0, mult: 1, lastH: Date.now() };
        let items = [
            { n: "Script Python", c: 15, p: 1, q: 0 },
            { n: "Proxy Dédié", c: 150, p: 8, q: 0 },
            { n: "Serveur Rack", c: 1000, p: 45, q: 0 },
            { n: "Botnet Mondial", c: 15000, p: 250, q: 0 }
        ];
        let hInterval;

        window.onload = () => {
            let saved = localStorage.getItem('CyberTycoon_V21');
            if (saved) {
                let d = JSON.parse(saved); g = d.g; items = d.items;
                updateUI();
            } else {
                document.getElementById('welcome-screen').style.display = 'flex';
            }
            startMatrix();
            setupHacking();
        };

        function initGame() {
            let p = document.getElementById('pseudo-input').value;
            if(p.length < 3) return alert("Pseudo trop court");
            g.n = p;
            document.getElementById('welcome-screen').style.display = 'none';
            save(); updateUI();
        }

        function setupHacking() {
            const isWE = (new Date().getDay() === 0 || new Date().getDay() === 6);
            document.getElementById('hack-mode').innerText = isWE ? "WE (30m)" : "Week (1h)";
            setInterval(() => {
                let limit = isWE ? (30*60*1000) : (60*60*1000);
                if (Date.now() - g.lastH > limit) triggerHack();
            }, 30000);
        }

        function triggerHack() {
            if (g.m < 100) return; // Pas de hack si pauvre
            const screen = document.getElementById('hack-alert');
            screen.style.display = 'flex';
            let t = 5; g.lastH = Date.now();
            hInterval = setInterval(() => {
                t--; document.getElementById('hack-timer').innerText = `Temps restant : ${t}s`;
                if(t <= 0) {
                    clearInterval(hInterval);
                    let loss = Math.floor(g.m * 0.20);
                    g.m -= loss; screen.style.display = 'none';
                    alert(`HACKÉ ! Perte de ${loss} €`);
                    updateUI();
                }
            }, 1000);
        }

        function defendSystem() {
            clearInterval(hInterval);
            document.getElementById('hack-alert').style.display = 'none';
            let b = Math.floor(g.m * 0.05) + 50;
            g.m += b; alert(`SÉCURISÉ ! Gain : ${b} €`);
            updateUI(); save();
        }

        function tap(e) { g.m += (1 * g.mult); updateUI(); save(); }

        function buy(i) {
            if(g.m >= items[i].c) {
                g.m -= items[i].c; items[i].q++;
                items[i].c = Math.floor(items[i].c * 1.5);
                updateUI(); save();
            }
        }

        function updateUI() {
            document.getElementById('m').innerText = Math.floor(g.m).toLocaleString() + " €";
            document.getElementById('display-name').innerText = g.n;
            document.getElementById('current-name').innerText = g.n;
            let pps = 0; items.forEach(it => pps += (it.q * it.p));
            document.getElementById('income-bar').innerText = "+" + (pps * g.mult).toLocaleString() + " €/s";

            let h = ""; items.forEach((it, i) => {
                h += `<div class="card"><b>${it.n}</b> (x${it.q})<br><small>+${it.p}€/s</small><button class="b-btn" ${g.m < it.c ? 'disabled' : ''} onclick="buy(${i})">ACHETER: ${it.c}€</button></div>`;
            });
            document.getElementById('s').innerHTML = h;

            let rivs = [{n:"Anonymous", m:1000000}, {n:"Satoshi", m:250000}, {n:g.n, m:g.m, me:true}].sort((a,b)=>b.m-a.m);
            let rh = ""; rivs.forEach((r, idx) => {
                rh += `<div class="rank-line ${r.me?'me':''}"><span>#${idx+1} ${r.n}</span><span>${Math.floor(r.m).toLocaleString()}€</span></div>`;
            });
            document.getElementById('leaderboard').innerHTML = rh;
        }

        function save() { localStorage.setItem('CyberTycoon_V21', JSON.stringify({ g, items })); }
        function tab(e, id) { 
            document.querySelectorAll('.p').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active'); e.target.classList.add('active');
        }
        function resetAll() { if(confirm("Supprimer tout ?")) { localStorage.clear(); location.reload(); } }

        function startMatrix() {
            const c = document.getElementById('matrix'); const ctx = c.getContext('2d');
            c.width = window.innerWidth; c.height = window.innerHeight;
            const drops = Array(Math.floor(c.width/10)).fill(1);
            setInterval(() => {
                ctx.fillStyle = "rgba(0,0,0,0.05)"; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle = "#0F0"; ctx.font = "10px monospace";
                drops.forEach((y, i) => {
                    ctx.fillText(Math.floor(Math.random()*2), i*10, y*10);
                    if(y*10 > c.height && Math.random() > 0.975) drops[i] = 0; drops[i]++;
                });
            }, 50);
        }

        setInterval(() => {
            let pps = 0; items.forEach(it => pps += (it.q * it.p));
            g.m += (pps * g.mult); updateUI();
        }, 1000);
    </script>
</body>
</html>

